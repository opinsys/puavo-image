PRECISE_IMAGE_TARGETS = ltsp-opinsysthinclient-precise \
			ltsp-thinclient-precise

TRUSTY_IMAGE_TARGETS = ltsp-desktop-trusty           \
		       ltsp-opinsysdesktop-trusty    \
		       ltsp-opinsysextra-trusty      \
		       ltsp-opinsysrestricted-trusty

IMAGE_TARGETS = $(PRECISE_IMAGE_TARGETS) $(TRUSTY_IMAGE_TARGETS)

CHROOT_TARGETS = chroot                        \
                 cleanup-chroot                \
                 dist-upgrade                  \
                 image                         \
                 puppet-chroot                 \
                 puppet-chroot-error-on-change \
                 puppet-local                  \
                 update-chroot

OTHER_TARGETS = all help ${CHROOT_TARGETS}

help:
	@echo "Available targets are:"
	@echo "  ${OTHER_TARGETS}" | fmt
	@echo
	@echo "Available image types are:"
	@echo "  ${IMAGE_TARGETS}" | fmt

all: ${IMAGE_TARGETS}

# XXX these belong to some configuration file... actually this Makefile should
# XXX die... but we want at least some shell completions?

ltsp-desktop-trusty:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --build $@ \
				--distribution trusty                   \
                                --puppet-classes image::desktop

ltsp-opinsysdesktop-trusty:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --build $@ \
				--distribution trusty                   \
                                --puppet-classes opinsysimage::desktop

ltsp-opinsysextra-trusty:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --build $@ \
				--distribution trusty                   \
                                --puppet-classes opinsysimage::extra

ltsp-opinsysrestricted-trusty:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --build $@ \
				--distribution trusty                   \
                                --puppet-classes opinsysimage::restricted

ltsp-opinsysthinclient-precise:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --build $@ \
				--distribution precise                  \
				--puppet-classes opinsysimage::thinclient

ltsp-thinclient-precise:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --build $@ \
				--distribution precise                  \
				--puppet-classes image::thinclient

chroot cleanup-chroot dist-upgrade image puppet-chroot puppet-chroot-error-on-change puppet-local update-chroot:
	@sudo /usr/lib/puavo-image-tools/puavo-imgbuild-tool --$@

.PHONY: ${IMAGE_TARGETS} ${OTHER_TARGETS}
